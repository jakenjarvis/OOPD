### OOPD形式: ユーザーフォーマット (User Format) 仕様

#### ユーザーフォーマットとは

ユーザーフォーマットは、ユーザーがOOPDに基づいてプロンプトを**日常的に記述・編集**するために設計された、柔軟で記述しやすい形式です。主に個人の作業やセッション内での利用を想定しています。 **この形式も「定義フォーマット」同様、AIへの具体的な指示書として扱われます。**

**注意:** このユーザーフォーマットのルールは、主に **英語以外の言語** でOOPD形式を記述する場合に適用されます。英語 (`en`) で記述する場合は、`english_specification.md` に基づき、常に定義フォーマットに準拠した厳密なルールが適用されます。

#### このドキュメントについて

このドキュメント (`format_user.md`) は、ユーザーフォーマットに特有のルールや特徴、推奨される使い方について説明します。共通のルールについては `format_common.md` を参照してください。

#### 主な特徴とルール

- **記述言語:** ユーザー自身の**母国語**（または作業言語）で記述することを基本とします。
- **英語ハブ名の省略（英語以外の言語）:**
  - **（注意: このルールは英語以外の言語で記述する場合に適用されます。）**
  - クラス名、インターフェース名、プロパティ名、メソッド名など、「定義フォーマット」で `{英語ハブ名}::` や `({英語ハブ名})` が付与される部分について、ユーザーフォーマットではこれらを**記述する必要はありません**。母国語名のみで記述します。AIが内部的に英語ハブ名を推論・管理します。
  - 例 (クラス見出し): `#### 顧客クラス: 顧客情報を管理するクラス` (OK)
  - 例 (プロパティ): - `名称: String`: 顧客の名前 (OK)
- **見出し:**
  - **モジュール (`##`)**: 記述は**必須ではありません**。ただし、複数のファイルを結合する場合や構造を明確にしたい場合は記述を推奨します。
  - **セクション (`###` など)**: 記述は**必須ではありません**。ユーザーが必要に応じて定義を整理するために使用できます。
  - **クラス (`####`) / インターフェース (`####`)**: 母国語名と説明文を記述します。英語ハブ名の併記は不要です。 **必要に応じて、見出しの下に詳細な説明や指示を記述することも可能です。** (`format_definition.md` の記述ルール参照)

      ~~~markdown
      例:
      #### 顧客クラス: 顧客情報を管理するクラス

      このクラスは重要で、顧客データを扱います。
      個人情報、購入履歴、連絡先などを含みます。

      **AIへの指示:** メールアドレスは直接出力しないでください。
      ~~~

  - **構造体定義/列挙型定義 グループ見出し (`####`)**:
    - **任意で使用可能**です。構造体定義や列挙型定義をまとめる場合に使用できます。
    - 見出し名は、**`basic_terms.md`** で定義された固定名称（例: `#### 構造体定義`）を使用することを**推奨**しますが、必須ではありません。ユーザーが分かりやすい見出しを使用しても構いません（AIは文脈から判断を試みます）。
  - **【重要】配置制約:** モジュール定義 (`##`) が記述されている場合、クラス定義、インターフェース定義、構造体/列挙型定義グループ見出しなどの主要な定義要素は、**必ずそのモジュール定義の下の階層 (`###` 以下) に配置**してください。トップレベルやモジュールと同じレベルには配置できません。
  - AIは、モジュールやセクションが明示されていない場合でも、文脈やデフォルト設定に基づいて内部的に定義を管理します。
- **リスト形式要素 (プロパティ、メソッド、イベント、列挙型、構造体):**
  - 行頭にハイフン `-` を付けます。
  - **リストの開始キーワード:** 定義フォーマットと同様に、各リストを開始する際には、対応する**基本用語**（**`basic_terms.md`** 参照、例: `Property`, `Method`, `Event`）をボールド表記で記述し、コロン `:` を付けることを**推奨**します（例: `**プロパティ:**`）。これによりAIの解釈精度が向上します。ただし、記述がない場合や逸脱がある場合でも、AIは文脈からリストの内容（プロパティかメソッドか等）を推測しようと試み、自動で付与します。
  - **バッククォート (`\``) の使用 (必須):** プロパティ、メソッド、イベント、列挙型定義、構造体定義をリスト形式で記述する際は、**必ずバッククォートを使用**してください。
    - これはAIによる定義部分の正確な解釈のためです。具体的な囲み方は「定義フォーマット」(`format_definition.md`) のルールを参照してください **(特に構造体と列挙型のバッククォート範囲に注意)**。
  - プロパティ、メソッド等の定義内容は、母国語名、型、引数、戻り値などで記述します（英語ハブ名不要）。**「定義フォーマット」と同様に、定義の後や次の行以降に説明文や指示を自由に記述できます。** (`format_definition.md` 参照)

      ~~~markdown
      例 (プロパティとメソッド):
      **プロパティ:**
      - `名前: String`: 顧客のフルネームを格納します。
      - `メールアドレス: String`: 連絡に使用するメールアドレスです。

      **メソッド:**
      - `価格計算(数量: Number, 単価: Number): Number`:
        税込み価格を計算します。
        - 消費税率は内部の固定値を使用します。
        - 数量が0以下の場合は0を返します。
        **AIへの指示:** 計算結果は小数点以下を切り捨ててください。
      ~~~

      ~~~markdown
      例 (列挙型):
      #### 列挙型定義
      - `タスク状態列挙型 = 未着手, 進行中, 完了`: タスクの状態です。
      - `色フラグ = 赤, 緑, 青`: 色のフラグ。
      *(↑ ユーザーフォーマットでは、列挙型名や値に英語ハブ名を付ける必要はありません)*
      *(↑ 区切り記号として `=` の使用を推奨しますが、`:` でもAIは解釈を試みます)*
      *(↑ バッククォートは `= 値リスト` まで囲むことを推奨します)*
      ~~~

      ~~~markdown
      例 (キーワード省略、AIが推測):
      - `名前: String`: 顧客のフルネームを格納します。
      - `メールアドレス: String`: 連絡に使用するメールアドレスです。
      - `価格計算(数量: Number, 単価: Number): Number`: 税込み価格を計算...
      - `タスク状態 = 未着手, 進行中, 完了`
      ~~~

- **命名規則（英語以外の言語）:**
  - **緩やか:** ユーザーフォーマットでは、AIが文脈から解釈できる限り、対象言語の標準的な命名規則（例: `ja_rules.md`参照）に厳密に従う必要はありません。逸脱した命名でもAIが認識できれば問題ありません。（**注意:** 英語 (`en`) で記述する場合は、`english_specification.md` の厳密な命名規則が常に適用されます。）
  - **標準規則の推奨:** ただし、標準的な命名規則に従う方が、AIの解釈精度が向上し、「定義フォーマット」への移行がスムーズになります。
  - **AIからの提案:** `interaction_mode_selection.md` で定義されている通り、ユーザーフォーマット利用時に標準命名規則から逸脱した名称が使われた場合、AIは標準名を **提案するのみ** で、確認や自動適用は行いません。

- **クロス参照:**
  - 参照したいクラス名などをそのまま母国語名で記述します。AIが文脈から判断しますが、曖昧さが生じる場合は確認を求めることがあります。異なるモジュールの要素を参照する場合は、「定義フォーマット」と同様に `モジュール名.クラス名` 形式での指定が推奨されます。
- **AIとの対話:**
  - **名称指示なし:** ユーザーが名称を指定しなかった場合、AIは文脈から標準名を自動生成します（ユーザー確認不要）。
  - **規則非準拠時の確認:** ユーザーが指定した名称が標準命名規則に準拠していない場合、AIが標準名を提案し、確認を求めることがあります。（この確認動作はユーザーの指示や設定に応じて変更可能です。例えば、確認なしで常に標準名を適用する、または確認なしでユーザーの命名を常に受け入れる、といった挙動も可能です）。

#### ユーザーフォーマットの利用シナリオ

- 個人でのプロンプト作成、アイデアの整理、下書き作成。
- セッション内でのAIとの対話を通じた定義の**明確化や洗練**。
- 一時的なプロンプト指示。

ユーザーフォーマットで作成された定義は、必要に応じてAIに指示することで、「定義フォーマット」に変換・出力することが可能です。
