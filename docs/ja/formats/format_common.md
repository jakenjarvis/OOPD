## OOPD形式 (Object-Oriented Prompt Design Format): 共通仕様

### OOPD形式とは

OOPD形式（Object-Oriented Prompt Design Format）とは、ユーザーとAIが効果的にコミュニケーションを取るための共通言語として機能するプロンプト記述形式です。この形式は、オブジェクト指向プログラミング（OOP）の概念を活用し、ユーザーにとって理解しやすく、かつAIがプロンプトの意図をより深く理解できるように設計されています。これにより、一貫性のある構造化された応答を生成することが可能となります。

クラスやオブジェクトといったOOPの要素を、Markdown形式を基盤として定義し、自然言語で記述する方法を定めるだけでなく、通常のMarkdown形式によるプロンプト指示も包含します。AIに対する指示と構造化された情報の両方を記述できる柔軟な形式です。 **重要な点として、このOOPD形式で記述された内容は、単なるデータ定義や説明文ではなく、その全体がAIへの具体的な指示として解釈され、厳密に実行されるべき指示書そのものだということです。AIは常にこれを意識していなければなりません。**

### このドキュメントについて

このドキュメント (`format_common.md`) は、OOPD形式の2つのバリエーションである「ユーザーフォーマット (`User Format`)」と「定義フォーマット (`Definition Format`)」の両方に**共通する基本的な原則と記述ルール**を定義します。言語固有のルールやフォーマットによる違いは、それぞれの仕様書 (`format_user.md`, `format_definition.md`, 各言語の翻訳ルール) を参照してください。

### 基本原則

- **Markdownベース:** 可読性と記述の容易さを考慮し、Markdown形式を基本とします。
- **OOP概念の活用:** クラス、インターフェース、プロパティ、メソッドなどのOOP概念をメタファーとして利用し、プロンプトの内容を構造化します。詳細な概念定義は `core.md` を参照してください。
- **構造化と自然言語の混在:** 構造化された定義部分と、自然言語による説明や指示をシームレスに記述できます。
- **文字エンコーディング:** プロンプトの記述およびAIによる解釈は、**UTF-8** を標準エンコーディングとして扱います。これにより、多言語環境での一貫性を保証します。

### 予約語との衝突禁止 (全言語共通・厳守)

OOPD形式でユーザーが定義する名前（モジュール名、クラス名、インターフェース名、列挙型名、構造体名、メソッド名、プロパティ名、イベント名、引数名など）は、**OOPDシステム自体で使用される予約語と絶対に衝突してはなりません。** これは、AIによるプロンプトの正確な解釈と、仕様の一貫性を保証するための **最重要ルール** です。

**予約語**とは、**プロンプトの記述言語に関わらず**、以下のものを指します:

- **`basic_terms.md` で定義される全ての基本用語:** これには、**英語のキーワード (`Class`, `Property` 等) だけでなく、定義されている全ての言語の固定表記キーワード（例: 日本語の `クラス`, `プロパティ`、フランス語の `Classe`, `Propriété` 等）** が含まれます。
- **`basic_terms.md` で定義される全ての標準型:** 例: `String`, `Number`, `Boolean`, `List`, `Dictionary`, `Void`, `Any` など。（これらは常に英語表記）
- **`extended_types.md` で定義される全ての拡張型:** 例: `ContentString`, `Persona`, `CodeBlock`, `Color`, `Ref` など。（これらは常に英語表記）
- **`basic_terms.md` で定義される全てのリテラル:** 例: `True`, `False`, `Null`。（これらは常に英語表記）

**【最重要】このルールは、プロンプトの記述言語と予約語の言語が異なる場合にも厳密に適用されます。** つまり、いかなる言語でプロンプトを記述している場合でも、`basic_terms.md` や `extended_types.md` に定義されている **全ての言語の予約語** をユーザー定義名として使用することは **絶対に禁止** されます。

- 例1: **英語**でプロンプトを記述中に、**ユーザー定義名として**（例えばクラス名やメソッド名として）日本語の予約語「`クラス`」やフランス語の予約語「`Classe`」を使用することは **できません** 。
- 例2: **日本語**でプロンプトを記述中に、**ユーザー定義名として**（例えばプロパティ名やイベント名として）英語の予約語「`Property`」やドイツ語の予約語「`Eigenschaft`」を使用することは **できません** 。

**AIへの指示:**

- AIは、プロンプトを解釈する際、ユーザー定義名が、 **記述言語に関わらず** 上記のいずれかの予約語（全ての言語の基本用語を含む）と衝突していないか **常に検証** してください。
- ユーザーが予約語と同じ名前を使用しようとした場合、AIはそれを **明確にエラーとして指摘** し、別の名前を使用するように **要求** してください。どの言語の予約語と衝突しているかを伝えることが望ましいです（例：「'プロパティ' は日本語の予約語であるため、メソッド名として使用できません」）。
- AI自身が応答や定義を生成する際も、 **絶対に予約語をユーザー定義名として使用してはなりません。**

このルールへの違反は、プロンプトの意図が破壊され、予測不能な動作を引き起こす可能性があるため、**絶対に許容されません。**

### Markdown記法と構造

- **見出しレベル:** Markdownの見出し (`#`, `##`, `###`, `####` など) を使用して、定義の階層構造を表現します。
  - `##`: **モジュール (Module)** 定義に使用します。OOPD定義の最上位コンテナです。モジュール名はグローバルな一意性が推奨されます (`english_specification.md`参照)。 **(`Module` の基本用語定義は `basic_terms.md` 参照)**
  - **セクション (Section):** Markdownの見出し (`###`, `####`, `#####` など) を使用して定義します。モジュール内の文書構造上のグルーピング（章立て）であり、オプションです。複数階層（ネスト）も可能です。 **セクションは名前解決や参照には影響しませんが、AIへの指示適用スコープには影響します (`core.md` 参照)。** 見出しテキストは自由記述（通常はプロンプト記述言語）です。
  - `####`: **個別のクラス (Class)** 定義や、**個別のインターフェース (Interface)** 定義に使用します。このレベルの見出しには、通常、定義されるクラス名やインターフェース名が含まれます (例: `#### MyClassName`)。 **(`Class`, `Interface` の基本用語定義は `basic_terms.md` 参照)**
  - `####`: **構造体定義をまとめるための固定名称の見出し**としても使用されます。この見出し名は、**基本用語**として **`basic_terms.md`** で定義された固定名称 (`Structure Definitions` / `構造体定義` など) を使用してください。個別の構造体定義は、この見出しの下にリスト形式 (`-`) で記述されます。
  - `####`: **列挙型定義をまとめるための固定名称の見出し**としても使用されます。この見出し名は、**基本用語**として **`basic_terms.md`** で定義された固定名称 (`Enum Definitions` / `列挙型定義` など) を使用してください。個別の列挙型定義は、この見出しの下にリスト形式 (`-`) で記述されます。
  - 見出し番号 (例: `1.`, `1.1`) は付けても付けなくても構いません。AIは番号ではなく見出しレベルとテキストで構造を認識します。

- **要素定義キーワード:** クラスやインターフェース内のプロパティ、メソッド、イベントなどの要素グループは、**`basic_terms.md` で定義された基本用語**（`Property`, `Method`, `Event` など）を **ボールド表記** にしたキーワードで示します。コロン (`:`) をキーワードの後につけます。
  - 例 (日本語の場合): `**プロパティ:**`, `**メソッド:**`, `**イベント:**`
  - 例 (英語の場合): `**Property:**`, `**Method:**`, `**Event:**`
    *(注意: 英語など言語によっては複数形が慣習的ですが、キーワードとしては単数形の基本用語を使用します)*

- **リスト:** 箇条書きリスト (`-`) を使用して、プロパティ、メソッド、イベント、列挙型定義、構造体定義などを定義します。
  - リスト要素は、必ず半角ハイフン(`-`) 1文字のみで開始し、その後ろに半角スペースを1つ入れてください。
  - 注意: Markdownの他のリスト記号（例: `*`, `+`）は絶対に使用しないでください。これらはOOPDフォーマット違反とみなされます。

- **コードブロック (` ``` `):** ドキュメント内にコード例やデータ例（YAML, JSONなど）を埋め込む際は、バッククォート3つ (` ``` `) で囲みます。これはAIが「定義フォーマット」全体を囲むコードブロック（`~~~`）と区別するためです。

      ```markdown
      例:
      ```yaml
      instanceData:
        name: Example
        value: 123
      ```
      ```

- **テーブル記法:**
  - テーブルは比較に便利ですが、複雑な構造情報はリスト形式の方がAIによる解釈や一貫した処理に適しています。
  - そのため、**AIが出力するOOPD形式では、構造表現にテーブルを使うことは非推奨**とし、リスト形式等を優先してください。
  - **ただし、ユーザーがプロンプト内でテーブルを使用した場合、AIはその構造を尊重し、解釈してください。応答生成時に無理に変換せず、保持することを推奨します。**

### 型とリテラルの表記 (全言語共通・英語表記統一)

OOPD形式内でプロパティ、引数、戻り値などの型を指定する場合、および特定のリテラル値を記述する場合は、**プロンプトの記述言語に関わらず、以下の標準英語表記を使用**します。これらの表記は**基本用語**として扱われ、翻訳されません (**定義は `basic_terms.md` を参照**)。

- **標準型 (Standard Types):**
  - `String`, `Number`, `Boolean`, `List`, `Dictionary`, `UniqueID`, `Instant`, `Void`, `Any`

- **拡張型 (Extended Types):**
  - `ContentString`, `Instruction`, `Persona`, `OutputStyle`, `CodeBlock`, `Ref`, `SchemaDefinition`, `JsonString`, `YamlString`, `XmlString`, `Color` など。
  - (拡張型の詳細は `extended_types.md` を参照)

- **リテラル (Literals):**
  - `True`, `False`, `Null`
  - (数値リテラル、文字列リテラルも通常通り使用可能)

- **型指定の記法 (リスト要素内):**
  - プロパティ: `{プロパティ名}: {型名}`
  - メソッド引数: `{引数名}: {型名}` または `{引数名}: {型名} = {初期値}`
  - メソッド戻り値: `): {戻り値型名}`
  - リストや辞書の型パラメータ: `< >` を使用します (例: `List<String>`, `Dictionary<String, Number>`)。

### テキストの扱いとコメントルール (厳守)

OOPD形式は、構造化された定義とそれを補足する自然言語テキスト（説明文や指示文）で構成されます。テキストの扱いに関して以下のルールを厳守してください。

- **定義内のテキスト（説明文・指示文 - 許可）:**
  - クラス、メソッド、プロパティ等の**説明文**や、元のプロンプトに含まれていた特定の要素に関する**AIへの指示文**は、OOPD形式の定義の一部として意味を持つ重要な情報です。これらは、関連する定義の近く（例: 見出しの下、定義の後）に**通常のMarkdownテキストとして記述**してください。AIはこれらを解釈し、応答生成に利用します。これらは**禁止されるコメントには該当しません。**
  - **【最重要確認事項・厳守義務】説明文を自然言語として明確に保ち、AIによる翻訳や解釈を容易にするため、説明文内でのインライン・バッククォート (`\``) および英語名の併記は、絶対に、いかなる理由があっても禁止されています。**
    - これは過去に繰り返し違反が確認されている最重要ルールであり、AIはこのルール違反を自身の重大な欠陥と認識し、絶対に回避しなければなりません。
    - 定義フォーマットの説明文内では、NullやTrueといった特定のキーワード（リテラル）を説明する際でも、それらをコード片や特別な用語として目立たせる目的で、インラインバッククォートを使用してはならない。(`format_definition.md` 参照)
    - 他の定義要素や特定の用語に言及する場合も、通常のテキストとして記述することを推奨します。
    - （例: `True` や `False` や `Null` や `{nativeName}` や `(englishName)` や `{englishName}::{nativeName}`）
  - 説明文は、原則としてプロンプトの記述言語で統一してください。引用など、明確な意図がある場合を除き、不必要な言語の混在は避けるべきです。
  - （定義フォーマットにおける厳密なルールは `format_definition.md` を参照してください。）

- **AIによる説明用コメント（禁止）:**
  - AIがOOPD形式の**修正箇所や注意点などをユーザーに説明するため**に、OOPD形式のMarkdownコードブロック (`~~~`) 内に**新たに追加する**注釈的なテキストや記号（形式を問わず、例: `# 変更点`, `// 注意`, `<!-- 修正 -->` など）は**絶対に禁止**します。
  - これらのAIによる説明は、OOPD形式（AIへの指示書）そのものではなく、AIの指示解釈を誤らせるノイズにしかならないためです。
  - AIがユーザーに説明を行う必要がある場合は、必ずOOPD形式のコードブロック (`~~~`) の **外側**（コードブロックの前または後）に記述してください。

- **ユーザー用メモコメント (HTML形式 - AIは無視・維持):**
  - ユーザーは、個人的なメモ等のためにHTML形式のコメント (`<!-- コメント内容 -->`) を使用できます。
  - AIは、この `<!-- ... -->` で囲まれたブロックを**完全に無視**し、解釈せず、**内容を変更せずそのまま維持**してください（削除・変更禁止）。
  - AIは、自身が応答や説明を生成する際に、このHTML形式を**絶対に使用してはなりません**。
