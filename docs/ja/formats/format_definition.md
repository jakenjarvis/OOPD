### OOPD形式: 定義フォーマット (Definition Format) 仕様

#### 定義フォーマットとは

定義フォーマットは、OOPDに基づいて作成された定義を、**他者と共有したり、異なるセッションや環境で再利用したりするための、厳格で正式な記述形式**です。定義の確定版であり、言語間での**可逆性**と解釈の**一貫性**を保証することを目的とします。

#### このドキュメントについて

このドキュメント (`format_definition.md`) は、定義フォーマットに特有の厳格なルールについて説明します。共通のルールについては `format_common.md` を参照してください。定義フォーマットは、プロンプトの記述言語に関わらず、以下のルールに従う必要があります。

#### 必須ルールと書式

- **英語ハブ名の併記（英語以外の言語）:**
  - **（注意: このルールは英語以外の言語で記述する場合に適用されます。英語で記述する場合は、英語名のみを使用し、ハブ名の併記は不要です。`english_specification.md` を参照してください。）**
  - クラス名、インターフェース名、列挙型名など、AIによる翻訳対象となる「翻訳用語」については、**必ず確定した英語ハブ名を併記**する必要があります。詳しくは以下の個別の記述方法を参照してください。
  - 英語ハブ名は、`english_specification.md` で定義された**英語命名規則**に従います。
  - 翻訳用語の母国語表記は、対象言語の翻訳ルール (`translation_rules/` 内) で定義された**標準命名規則**に従います。
- **厳密な命名規則の適用:**
  - 上記の通り、母国語名と英語ハブ名の両方について、それぞれの言語で定義された**標準命名規則を厳密に適用**する必要があります。（英語で記述する場合は、`english_specification.md` で定義された英語命名規則のみが適用されます。）
  - モジュール名は、`english_specification.md` で定義された英語命名規則に従い、グローバルな一意性を確保することが強く推奨されます。
- **英語ハブ名と母国語名の認識:**
  - AIは、定義に `{英語ハブ名}::{母国語名}` の形式で併記されている要素について、**英語ハブ名と母国語名の両方を、その要素を指す有効な識別子として認識**します。
- **クロス参照:**
  - **同一モジュール内:** 参照したいクラス名などを、**必ず母国語名のみ**で記述します (例: `プロパティ名: 顧客クラス`)。英語ハブ名は記述しません。AIは文脈からモジュール内の定義を特定します。
  - **異なるモジュール:** 参照したいクラス等が別のモジュールに属する場合、**必ず完全修飾名 (`モジュール名.クラス名`)** で指定する必要があります。型指定の場合も同様です。（例: `作成者 (com.example.common.User)`）
- **説明文の推奨:**
  - 各モジュール、セクション、クラス、インターフェース、メソッド、プロパティなどには、その目的や意味を明確にするための**説明文を記述することを強く推奨**します。AIの解釈補助や人間による理解促進に役立ちます。説明文はプロンプト記述言語で記述します。
- **モジュール定義 (`##`):**
  - 全ての定義は必ずモジュール内に記述する必要があります。
  - 書式: `## {英語モジュール名}`
  - モジュール名はグローバルな一意性が推奨されます (`english_specification.md`参照)。
  - モジュールの母国語名や詳細な説明文は、`##` 行の下に通常のテキストとして記述できます（オプション）。
- **見出し (クラス `####`, インターフェース `####`, セクション `###`/`####`/..., 構造体定義 `####`, 列挙型定義 `####`):**
  - **クラス/インターフェース (個別定義):**
    - 書式 (母): `{見出しレベル} {母国語名} ({英語ハブ名}): {簡易説明文}`
    - 書式 (英): `{見出しレベル} {英語名}: {簡易説明文}`
    - **【重要】名前の順序は `{母国語名} ({英語ハブ名})` または `{英語名}` です。逆にならないように注意してください。**
    - **簡易説明文は必須**です。
    - 見出し行の下に、**詳細な説明文**や**このクラス/インターフェースに関するAIへの指示**などを、通常のMarkdownテキストとして複数行にわたり記述できます（オプション）。

      ~~~markdown
      例 (日本語):
      #### 顧客クラス (Customer): 顧客情報を管理するクラス

      このクラスは、システムの中心となる顧客データを扱います。
      ...

      個人情報保護法に準拠すること。
      ~~~

      ~~~markdown
      例 (英語):
      #### Customer: Manages customer information

      This class handles core customer data.
      ...

      Comply with privacy regulations.
      ~~~

    *(`Class`, `Interface` の基本用語定義は `basic_terms.md` 参照)*

  - **セクション (Section):**
    - Markdownの見出し (`###`, `####`, `#####` など) を使用して定義します。
    - 書式: `{見出しレベル} {母国語名} ({英語ハブ名})` または `{見出しレベル} {母国語名} ({英語ハブ名}): {説明文}`
    - **説明文は省略可能**です。
    - **英語が母国語の場合:** `{英語名}` のみとなり、英語ハブ名の括弧は不要です。説明文のルールは上記と同様です。
    - `format_common.md` のルールに従い、複数階層（ネスト）も可能です。
    - **【重要】** クラス定義 (`#### {個別のクラス名}`)、インターフェース定義 (`#### {個別のインスタンス名}`)、`#### {構造体定義の固定名称}` グループ、`#### {列挙型定義の固定名称}` グループなどは、モジュール直下だけでなく、任意のレベルのセクション内に配置することができます。
    - **【制約】ただし、これらの定義要素（クラス、インターフェース、グループ見出し）は、必ずモジュール定義 (`##`) よりも下の階層（`###` 以下）に記述する必要があります。** トップレベルやモジュールと同じレベルには配置できません。（これは、複数の定義ファイルを結合した際の構造的な一貫性を保つためです。）
  - **`#### {構造体定義の固定名称}` / `#### {列挙型定義の固定名称}` (グループ見出し):**
    - `format_common.md` で参照が指示されている通り、**`basic_terms.md`** で定義された言語ごとの **固定名称の見出し**（例: 日本語では `#### 構造体定義`、英語では `#### Structure Definitions`）を使用します。
    - これらは、それぞれ構造体定義、列挙型定義をまとめるためのグループ見出しであり、任意で使用できます。
    - 個別の構造体定義や列挙型定義は、必ずこれらのグループ見出しの下にリスト形式 (`-`) で記述されます。
    - グループ見出しに英語ハブ名を `()` で併記する必要はありません。
    - グループ見出しの下に、必要であればグループ全体の説明文を記述できます。
    *(基本用語定義は `basic_terms.md` 参照)*

- **要素名 (プロパティ名、メソッド名、イベント名、列挙型定義名、列挙型値、構造体定義名):**
  - 母国語が「主」、英語ハブ名が「副」となります。
  - 英語ハブ名を**接頭辞**として、ダブルコロン `::` で母国語名に接続します。
  - 基本形式: `{英語ハブ名}::{母国語名}`
  - **（英語以外の言語の場合）** 上記の通りです。
  - **英語が母国語の場合:** 接頭辞 (`{英語ハブ名}::`) は不要です。`english_specification.md` のルールに従い、英語名のみを記述します。

- **リスト形式要素 (プロパティ、メソッド、イベント、列挙型、構造体) の定義:**
  - 行頭にMarkdownリストのハイフン `-` を付けます。
  - **リストの開始キーワード:** 各リスト（プロパティリストなど）を開始する際には、対応する **基本用語** をボールド表記で記述し、コロン `:` を付けます。使用する基本用語は **`basic_terms.md`** を参照してください。
    - 例 (日本語): `**プロパティ:**`, `**メソッド:**`, `**イベント:**`
    - 例 (英語): `**Property:**`, `**Method:**`, `**Event:**`
  - **バッククォート (`\``) の適用範囲:**
    - (`format_common.md` 準拠)
    - **プロパティ、メソッド、イベント:** 定義の主要部分（ハイフン直後のスペース後から型/戻り値指定まで）**のみ** を囲みます。説明は囲みません。
    - **列挙型、構造体(個別定義):** 要素名の部分（`{英語ハブ名}::{母国語名}` または `{英語名}`）**のみ**を囲みます。説明や値リストは囲みません。
  - **説明文と指示文:** 各要素定義（プロパティ、メソッド等）の**コロン `:` の後ろ、または次の行以降**に、その要素に関する**詳細な説明やAIへの指示**などを、**通常のMarkdownテキストとして複数行にわたり記述できます。** 説明内でリストなどのMarkdown要素を使用することも可能です。定義行のコロン `:` の後に簡易説明を記述せず、次の行から説明を開始することもできます。

      ~~~markdown
      共通の複数行記述例:

      **プロパティ:**
      - `propertyName1::プロパティ名1: Type`: 説明...（１行で書ききってもよい）
      - `propertyName2::プロパティ名2: Type`:
        説明...（複数行にわたって書いてもよい）
        (説明例: 以下のようなMarkdownも使用できます)
        このプロパティは〇〇を表します。
        初期値はXXXです。
        値がNullの場合はデフォルト値を使用してください。

      **メソッド:**
      - `methodName1::メソッド名1(引数: Type): ReturnType`: 説明...（１行で書ききってもよい）
      - `methodName2::メソッド名2(引数: Type): ReturnType`:
        説明...（複数行にわたって書いてもよい）
        (説明例: 以下のようなMarkdownも使用できます)
        - このメソッドは△△を実行します。引数には□□を指定してください。
          1. 引数が条件１の場合は、Ａを実行します。
          2. 引数が条件２の場合は、Ｂを実行します。
          3. 上記いずれでもない場合は、Ｃを実行します。
      ~~~

- **プロパティ定義:**
  - 書式 (母): - \`{英語ハブ名}::{母国語名}: {型名}\`: {説明}
  - 書式 (英): - \`{英語名}: {型名}\`: {説明}
  - **型名:**
    - **標準型/拡張型:** 必ず英語表記 (`String`, `Number`, `List<String>`, `Color` など) を使用します (**定義は `basic_terms.md` および `extended_types.md` 参照**)。
    - **ユーザー定義型 (クラス、インターフェース、列挙型、構造体):** **【重要】必ず母国語名のみ**で参照します (例: `顧客クラス`, `色フラグ列挙型`)。英語ハブ名は記述しません。
  - **オプション項目:**
    - プロパティ定義では、型名の後に `, {オプション指示子}` を追記することで任意項目を示すことができます（オプション指示子の基本用語 **`Optional`** (`ja`: `オプション`) の定義は **`basic_terms.md`** 参照）。
      - 例 (日本語): - \`プロパティ名: String, オプション\`
      - 例 (英語): - \`propertyName: String, Optional\`

- **メソッド定義:**
  - 書式 (母): - \`{英語ハブ名}::{母国語名}({引数リスト}): {戻り値型名}\`: {説明}
  - 書式 (英): - \`{英語名}({引数リスト}): {戻り値型名}\`: {説明}
  - **戻り値型名:** プロパティの型名ルールと同様です (標準型は英語、ユーザー定義型は母国語)。`Void` は省略可能ですが、**記載を推奨**します。
  - **引数リスト:** カンマ区切りで `{引数名}: {型名}` または `{引数名}: {型名} = {初期値}`。
  - **引数名:** 母国語表記のみを使用し、英語ハブ名は付与しません。（英語の場合は英語表記）
  - **引数の型名:** プロパティの型名ルールと同様です (標準型は英語、ユーザー定義型は母国語)。
  - **デフォルト値 (`= {初期値}`):**
    - メソッド定義では、引数の型名の後に `= {初期値}` を追記することでデフォルト値を表現できます。
    - **初期値の表記:**
      - リテラル (`True`, `False`, `Null`, 数値, 文字列) はそのまま記述します (**定義は `basic_terms.md` 参照**)。
      - **列挙型の値:** **【重要】必ず母国語名**で記述します (例: `= 赤`, `= 未着手`)。英語ハブ名は記述しません。（英語の場合は英語表記）
      - 例 (日本語): - \`メソッド名(フラグ: Boolean = True, ステータス: タスク状態 = 未着手): Void\`
      - 例 (英語): - \`methodName(flag: Boolean = True, status: TaskStatus = NOT_STARTED): Void\` (※英語の場合は列挙値も英語)
  - **【重要】引数がない場合でも、必ず空の括弧 `()` を記述してください。** (例: `メソッド名()`)

- **イベント定義:**
  - 書式 (母): - \`{英語ハブ名}::{母国語名}({引数リスト})\`: {説明}
  - 書式 (英): - \`{英語名}({引数リスト})\`: {説明}
  - **戻り値:** 通常 `Void` ですが、**記載の省略を推奨**します。
  - **引数リスト:** メソッド定義と同様のルールに従います。引数名、型名、初期値は母国語表記（英語の場合は英語表記）です。
  - **【重要】引数がない場合でも、必ず空の括弧 `()` を記述してください。** (例: `イベント名()`)

- **列挙型定義 (個別):**
  - 必ず `#### {列挙型定義の固定名称}` グループ見出しの下（またはその下のセクション内）に、**リスト形式 (`-`)** で記述します。
  - 書式 (母): - \`{英語ハブ名}::{母国語名} = {値リスト}\` [: {説明}]
  - 書式 (英): - \`{英語名} = {値リスト}\` [: {説明}]
  - **区切り記号:** 列挙型名と値リストの間は `=` (イコール) で区切ります。
  - **値リスト:** カンマ区切りで `{英語ハブ名}::{母国語名}`（または英語のみ）形式の値を列挙します。値の間にスペースを入れることを推奨します (例: `RED::赤, GREEN::緑`)。
  - バッククォート: バッククォート (`) は、ハイフン直後のスペースの後から始まり、**値リストの最後まで**を囲みます。説明文は囲みません。
  - **説明:** 各列挙型定義のコロン `:` の後ろに説明を記述できます（任意）。説明はバッククォートの外側に記述します。

      ~~~markdown
      例:
      #### 列挙型定義

      - `TaskStatus::タスク状態列挙型 = NOT_STARTED::未着手, IN_PROGRESS::進行中, COMPLETED::完了`: タスクの進捗状況を表します。
      - `ColorFlag::色フラグ列挙型 = RED::赤, GREEN::緑, BLUE::青`:
        基本的な色要素を表すビットフラグです。
        組み合わせて色を表現します (例: 紫 = 赤 + 青)。
      - `FileAccess::ファイルアクセス列挙型 = READ_ONLY::読み取り専用, READ_WRITE::読み書き可能`
        *(説明がない場合の例)*
      ~~~

- **構造体定義 (個別):**
  - 必ず `#### {構造体定義の固定名称}` グループ見出しの下（またはその下のセクション内）に、**リスト形式 (`-`)** で記述します。
  - 書式 (母): - \`{英語ハブ名}::{母国語名}\`: {説明}
  - 書式 (英): - \`{英語名}\`: {説明}
  - **説明:** コロン `:` の後ろに説明を記述します（必須）。

  **構造体の利用指針**
  - **単純なデータコンテナ推奨:** 構造体は、`座標クラス` のような、AIが名称と説明文から内容を推測できる単純なデータ保持の用途を推奨します。
  - **明示的な定義は非推奨:** クラスのように `**プロパティ:**` 等で要素を明示的に定義することは **強く非推奨** です。
  - **推奨される指定:** 必要なプロパティは、構造体の**説明文内に自然言語で記述**してください (例: 「`X座標 (Number)` を持つ」)。AIはこの指示を優先します。
  - **クラスの利用:** プロパティやメソッドの詳細な定義が必要な場合は、構造体ではなく **クラス (`Class`) を使用** してください。

- **基底クラスとインターフェースの実装:**
  - クラス定義内で、実装する基底クラスやインターフェースを示すには、対応する **基本用語** をボールド表記で使用します。使用する基本用語は **`basic_terms.md`** を参照してください。
  - **継承:**
    - 書式 (日本語例): `**基底クラス:** {基底クラスの母国語名}` (キーワードは `baseclass` の基本用語)
    - 書式 (英語例): `**baseclass:** {BaseClassName}` (キーワードは `baseclass` の基本用語)
    - **【重要】必ず母国語名のみで参照してください。**
  - **インターフェース実装:**
    - 書式 (日本語例): `**インターフェース:** {インターフェース1の母国語名}, {インターフェース2の母国語名}, ...` (キーワードは `Interface` の基本用語)
    - 書式 (英語例): `**Interface:** {InterfaceName1}, {InterfaceName2}, ...` (キーワードは `Interface` の基本用語)
    - **【重要】必ず母国語名のみで参照してください。** 複数指定する場合はカンマ区切りです。

- **型の参照:**
  - プロパティや引数、戻り値で型を指定する際、ユーザー定義クラスや列挙型を参照する場合も、**母国語名のみ**を記述し、英語ハブ名は付けません。

#### 出力ルール

- AIが「定義フォーマット」で出力を指示された場合は、**必ずOOPD形式(Markdown形式)の出力全体をコードブロック「\`\`\`markdown ... \`\`\`」を使用して囲んで表示**してください。（ただし、OOPD形式内のコードブロックは「~~~」を使用して囲みます）
- インスタンスのデータを出力する際は、標準として**YAML形式のコードブロック（`~~~yaml` ... `~~~`）**で出力します。ユーザーが別途指示をした場合はJSON等の他の形式でも構いません。

#### 定義フォーマットの確定プロセス

- 通常、「定義フォーマット」は、ユーザーが「ユーザーフォーマット」で作成した内容を基に、AIに生成を指示します。
- AIは生成時に、上記の必須ルール（英語名併記、命名規則、モジュール所属など）への準拠を自動チェックします。
- チェックで問題が見つかった場合（例: 命名規則違反、英語名不明瞭、モジュール未定義など）、AIはユーザーに問題点を指摘し、修正を促します。AIが修正案を提示する場合もあります。
- ユーザーがAIとの対話を通じて問題を解消し、内容を確認・承認することで、「定義フォーマット」が確定します。
