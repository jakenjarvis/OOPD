## OOPD形式 (Object-Oriented Prompt Design Format): 共通仕様

### OOPD形式とは

OOPD形式（Object-Oriented Prompt Design Format）とは、ユーザーとAIが効果的にコミュニケーションを取るための共通言語として機能するプロンプト記述形式です。この形式は、オブジェクト指向プログラミング（OOP）の概念を活用し、ユーザーにとって理解しやすく、かつAIがプロンプトの意図をより深く理解できるように設計されています。これにより、一貫性のある構造化された応答を生成することが可能となります。

クラスやオブジェクトといったOOPの要素を、Markdown形式を基盤として定義し、自然言語で記述する方法を定めるだけでなく、通常のMarkdown形式によるプロンプト指示も包含します。AIに対する指示と構造化された情報の両方を記述できる柔軟な形式です。

### このドキュメントについて

このドキュメント (`format_common.md`) は、OOPD形式の2つのバリエーションである「ユーザーフォーマット (`User Format`)」と「定義フォーマット (`Definition Format`)」の両方に**共通する基本的な原則と記述ルール**を定義します。言語固有のルールやフォーマットによる違いは、それぞれの仕様書 (`format_user.md`, `format_definition.md`, 各言語の翻訳ルール) を参照してください。

### 基本原則

- **Markdownベース:** 可読性と記述の容易さを考慮し、Markdown形式を基本とします。
- **OOP概念の活用:** クラス、インターフェース、プロパティ、メソッドなどのOOP概念をメタファーとして利用し、プロンプトの内容を構造化します。詳細な概念定義は `core.md` を参照してください。
- **構造化と自然言語の混在:** 構造化された定義部分と、自然言語による説明や指示をシームレスに記述できます。

### Markdown記法と構造

- **見出しレベル:** Markdownの見出し (`#`, `##`, `###`, `####` など) を使用して、定義の階層構造を表現します。
  - `##`: **モジュール (Module)** 定義に使用します。OOPD定義の最上位コンテナです。モジュール名はグローバルな一意性が推奨されます (`english_specification.md`参照)。
  - `###` 以下: **セクション (Section)** 定義に使用します。モジュール内の文書構造上のグルーピング（章立て）であり、オプションです。複数階層も可能です。**セクションは名前解決や参照には影響しません。** 見出しテキストは自由記述（通常はプロンプト記述言語）です。
  - `####`: **クラス (Class)**, **インターフェース (Interface)**, **列挙型 (Enum)** などの主要な要素定義に使用します。
  - 見出し番号 (例: `1.`, `1.1`) は付けても付けなくても構いません。AIは番号ではなく見出しレベルとテキストで構造を認識します。
- **要素定義キーワード:** クラス内のプロパティ、メソッド、イベントなどの要素は、**言語ごとの基本用語**（`core.md`の`基本用語 表記` JSON参照）とコロン (`:`) で開始します。
  - 例 (日本語の場合): `**プロパティ:**`, `**メソッド:**`
  - 例 (英語の場合): `**Properties:**`, `**Methods:**`
- **リスト:** 箇条書きリスト (`-`, `*`) を使用して、プロパティ、メソッド、列挙値などを列挙します。
- **コードブロック (`---`):** ドキュメント内にコード例やデータ例（YAML, JSONなど）を埋め込む際は、ハイフン3つ (`---`) で囲みます。これはAIが `定義フォーマット` 全体を囲むコードブロック（\`\`\`）と区別するためです。

      \`\`\`markdown
      例:
      ---yaml
      instanceData:
        name: Example
        value: 123
      ---
      \`\`\`

- **テーブル記法:**
  - Markdownのテーブル記法は、複雑な情報を表現する際に可読性が低下する可能性があります。そのため、**AIがOOPD形式を生成して出力する際には、テーブルの使用は非推奨**とし、可能な限りリスト形式などを使用してください。
  - ただし、**ユーザーがプロンプト内でテーブルを使用している場合は、AIはそれを保持し、無理に他の形式に置き換える必要はありません。**

### 型とリテラルの表記 (全言語共通・英語表記統一)

OOPD形式内でプロパティ、引数、戻り値などの型を指定する場合、および特定のリテラル値を記述する場合は、**プロンプトの記述言語に関わらず、以下の標準英語表記を使用**します。これらの表記は**基本用語**として扱われ、翻訳されません (`core.md`参照)。

- **標準型 (Standard Types):**
  - `String`: 文字列を表す型。
  - `Number`: 数値を表す型 (整数・浮動小数点数)。
  - `Boolean`: 真偽値を表す型。
  - `List<T>`: リストを表す型 (例: `List<String>`)。
  - `Dictionary<K, V>`: 辞書 (キー/値ペア) を表す型 (例: `Dictionary<String, Number>`)。
  - `UniqueID`: 一意識別子を表す型 (UUID形式文字列想定)。
  - `Instant`: 特定の瞬間を表す型 (ISO 8601形式文字列推奨)。
  - `Void`: 値がないことを示す型 (主に戻り値用)。
  - `Any`: 任意の型を表す型。

- **拡張型 (Extended Types):**
  - `ContentString`, `Instruction`, `Persona`, `OutputStyle`, `CodeBlock`, `Ref`, `SchemaDefinition`, `JsonString`, `YamlString`, `XmlString`, `Color` など。
  - (拡張型の詳細は `extended_types.md` を参照)

- **リテラル (Literals):**
  - `True`: 真の値。
  - `False`: 偽の値。
  - `Null`: Null値。

- **型指定の記法 (推奨):**
  - プロパティ:
    - `- {プロパティ名}: {型名}`: 説明
    - `- {プロパティ名}: {型名}, {オプション指示子}`: 説明 (オプション指示子の用語は `core.md` 参照)
  - メソッド:
    - `- {メソッド名}({引数名}: {型名} = {初期値}): {戻り値型名}`: 説明 (初期値やオプション指示子は任意)
  - リストや辞書の型パラメータ: `< >` を使用します (例: `List<String>`, `Dictionary<String, Number>`)。

### コメントルール (厳守)

- AIがOOPD形式の修正案などを提示する際、**OOPD形式の定義内に直接コメント（例: `<!-- 修正点 -->` や `# TODO` など）を記述することは絶対に禁止**します。
- 理由は、OOPD形式はプロンプト指示文そのものであり、機械的な比較・処理を妨げる可能性があるため、また差分表示が見にくくなるためです。
- 修正に関する説明やコメントが必要な場合は、OOPD形式のコードブロックの**外側**（コードブロックの前または後）に記述してください。
